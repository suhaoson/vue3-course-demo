### 跨组件数据通信：常见的组件间数据通信方式有哪些？

Vue.js3 的数据跨组件通信，核心就是进行不同组件的数据联动，也就是数据通信。

#### Vue.js3 项目开发过程有哪些组件通信场景？

一般，组件的组合有基于组件嵌套的“父子组件”和基于组件并行组合的“兄弟组件”这两种情况，所以组件的数据通信一般都是处理“父子组件数据相互通信”和“兄弟组件数据相互通信”这两种场景。<br/>

在 Vue.js 中实现“父子组件”和“兄弟组件”数据单向数据通信，一般都是通过 Props 来进行的。“父组件”通过 Props 传入数据给“子组件”，而“兄弟组件”是基于“公共父组件”通过 Props 将数据传入子“兄弟组件”中，例如下图所示：
![](https://static001.geekbang.org/resource/image/43/8f/43487942ff178bfbf4feda5f4ce3b18f.jpg?wh=3000x1478)
<br/>
在实际过程中，这类通过纯 Props 的传输方式只能<b>单向传递数据</b>，不是双向传递，也就是数据只能从父组件流向子组件，或者从一个兄弟组件流向子兄弟组件。

#### 如何基于 Props 和 Emits 实现跨组件通信？

Props 是父组件通过设置属性来传递数据给子组件，也就是父组件可以通过 Props 单向给子组件传递数据。<br/>
而 Emits 呢，是给子组件传入自定义事件，父组件可以把操作“父级数据”方法放在这个事件中传入子组件，子组件里执行这个传入的事件间接操作“父级数据”，达到在子组件里向父组件进行数据通信的效果。

#### 使用公共响应式数据文件实现跨组件通信

这种方法也就是响应式数据不通过 Props 传递，而是通过“组合方式”使用，这也是发挥了“响应式数据”+“组合式 API” 的双重优势。我先给你画个图讲解一下：
![](https://static001.geekbang.org/resource/image/f8/ec/f8026764ac2yya1407d2677e7ae6b4ec.jpg?wh=3000x1501)
<br/>
我们把公共数据都放在一个响应式数据的文件里，无论是父组件还是子组件，都直接引用这个文件里的数据，然后直接在各自组件间进行读数据或写数据。
<br/>
直接用一个公共的文件管理响应式数据进行组件间数据通信，是不是很自由方便？但是自由方便都是有代价的，这个代价就是不好管理和维护。

#### 基于 Pinia 实现的跨组件数据通信

Pinia 就是一个基于 Proxy 实现的 Vue.js 公共状态数据管理的 JavaScript 库，可以提供组件间的数据通信，也可以跟踪定位数据的变化。
![](https://static001.geekbang.org/resource/image/6c/44/6c4ecc66cb791af67759897594879644.jpg?wh=4000x2036)
<br/>
这里要特别注意，在使用 Pinia 时候，在 Vue.js3 应用挂载 DOM 节点前，要在 Vue.js3 应用里加上 Pinia 插件的使用，也就是注册 Pinia 插件到项目里：import { createApp } from 'vue';import { createPinia } from 'pinia';import App from './app.vue';const app = createApp(App);const pinia = createPinia();// 加载 pinia 插件 app.use(pinia);app.mount('#app');
<br/>
更多 Pinia 的使用方式，你可以查看[Pinia 的官网](https://pinia.vuejs.org/)。

<b>Vue.js3 的组件间数据通信的多个方式，主要有三种，也各有优缺点：</b>

- 基于 Props+Emits 的组件数据通信，让数据流向更加清晰，但是需要写很多组件间事件回调的传递代码；
- 基于公共响应式数据文件进行通信，最简单，也是最能发挥响应式特性，但是代码管理不善容易带来数据通信混乱；
- 基于 Pinia 的公共数据状态管理，虽然增加了学习成本，但是能管理好项目数据流向，也充分利用响应式的特性，来实现复杂大型项目的组件间通信。
  <br/>

<b>在实际项目开发过程中，我们可以根据不同方式的特点灵活选择：</b>

- 如果开发一些 Vue.js 组件库，可以基于 Props+Emits 来做组件库内部数据通信，这样可以方便管理组件库里组件的数据状态变化，减少数据污染；
- 如果要快速开发一些小型 Vue.js3 应用，可以直接“基于公共的响应式数据文件进行通信”，因为这种方式比较自由方便，不用写太多的数据定义和自定义事件的代码；
- 如果要开发大型 Vue.js3 项目，例如一些管理后台等复杂应用，建议你用 Pinia 来进行组件间的数据通信，方便数据的灵活使用和状态数据的流向管理。

> 此文章为 3 月 Day7 学习笔记，内容来源于极客时间《Vue 3 企业级项目实战课》，学习使我快乐，每天进步一点点 💪💪
